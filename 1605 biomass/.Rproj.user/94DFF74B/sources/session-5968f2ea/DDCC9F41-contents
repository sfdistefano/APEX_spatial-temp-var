## Summarizing observational data
observed_data_summarized <- observed_data %>%
  group_by(Year,Treatment, Pasture,APEXcodeFG) %>%
  dplyr::summarize(MeankgPerHa = mean(v1)) %>%
  subset(APEXcodeFG %in% c("WSPG", "CSPG", "SS", "FORB", "CSAG") &
           Treatment %in% c("AGM","TGM"))%>%
  mutate(Type = "Observed",
         Date = ymd(paste(Year, 8, 6, sep = "-")),
         WS = NA,
         APEXcodeFG=as.character(APEXcodeFG)) %>%
  ungroup(Year) %>%
  select(-Year)

# Changing plant codes
observed_data_summarized <- change_plant_codes(observed_data_summarized)

# changing one pasture name
observed_data_summarized$Pasture <- gsub("NH", "10S", observed_data_summarized$Pasture)

path <- "C:/01-APEX1605_CO_baseline//Cage Biomass Simulation/APEX1605_CO_all20_cagebm/CONUNN_TGM.cag"

## Importing simulated data
simulated_biomass <- import_and_filter_data(path) %>%
  mutate(Treatment = ifelse(ID %in% 1:10, "TRM", "CARM"))

## Importing reference information
PastureID <- read.csv("C:/APEX data and scripts/Data/PastureID_ecosite_20subareas.csv") %>%
  mutate(Treatment = ifelse(Treatment == "TGM", "TRM", "CARM"))

## Cleaning simulated data
simulated_biomass02 <- clean_biomass_data(simulated_biomass)

# Visualization
test <- simulated_biomass02 %>% filter(month(Date) == 8,
                                       day(Date) == 6) %>%
  filter(Treatment == "TRM")

test_merge <- merge(test, observed_data_summarized,
                    by = c("Pasture", "APEXcodeFG", "Date"))


write.csv(test_merge, "C:/APEX data and scripts/APEX outputs/test_output_compare_noVar_allTRM.csv")